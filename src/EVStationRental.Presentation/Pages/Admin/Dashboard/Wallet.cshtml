@page
@using System.Linq
@using EVStationRental.Presentation.Models.Admin.Dashboard
@model EVStationRental.Presentation.Pages.Admin.Dashboard.WalletModel
@{
    ViewData["Title"] = "Báo cáo ví & thanh toán";
}

<div class="admin-layout">
    <partial name="~/Pages/Shared/_AdminSidebar.cshtml" />
    <div class="admin-content">
        <div class="page-card mb-4">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <h2 class="mb-0">Báo cáo ví &amp; thanh toán</h2>
                <span class="text-muted">@Model.RevenueData.FilterDescription</span>
            </div>
            @await Html.PartialAsync("~/Pages/Shared/_DashboardFilter.cshtml", Model.FilterVm)
        </div>
@{
    var stationBreakdown = Model.Orders.Stations ?? new List<StationOrderCountItem>();
    var completed = stationBreakdown.Sum(s => s.CompletedOrders);
    var pending = stationBreakdown.Sum(s => s.PendingOrders + s.ConfirmedOrders + s.OngoingOrders);
}
        <section class="grid-cards mb-4">
            <div class="stat-card">
                <p class="stat-card__label">Tổng tiền luân chuyển</p>
                <div class="stat-card__value">@Model.RevenueData.TotalRevenue.ToString("n0") đ</div>
            </div>
            <div class="stat-card">
                <p class="stat-card__label">Tổng đơn</p>
                <div class="stat-card__value">@Model.RevenueData.TotalOrders</div>
            </div>
            <div class="stat-card">
                <p class="stat-card__label">Đơn hoàn tất</p>
                <div class="stat-card__value">@completed</div>
                <small>Đang xử lý: @pending</small>
            </div>
            <div class="stat-card">
                <p class="stat-card__label">Thời gian</p>
                <div class="stat-card__value" style="font-size:1.1rem;">@Model.RevenueData.FilterDescription</div>
            </div>
        </section>

        <div class="page-card mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">Top trạm mang doanh thu</h5>
                <small class="text-muted">Nguồn tiền chính của kỳ</small>
            </div>
            <div class="table-responsive">
                <table class="table table-modern mb-0">
                    <thead>
                        <tr>
                            <th>Trạm</th>
                            <th class="text-end">Đơn</th>
                            <th class="text-end">Doanh thu</th>
                        </tr>
                    </thead>
                    <tbody>
                    @if (!Model.TopStations.Any())
                    {
                        <tr>
                            <td colspan="3" class="text-center text-muted py-4">Không có dữ liệu.</td>
                        </tr>
                    }
                    else
                    {
                        foreach (var station in Model.TopStations)
                        {
                            <tr>
                                <td>@station.StationName</td>
                                <td class="text-end">@station.TotalOrders</td>
                                <td class="text-end">@station.TotalRevenue.ToString("n0") đ</td>
                            </tr>
                        }
                    }
                    </tbody>
                </table>
            </div>
        </div>

        <div class="flash flash-info">
            Số liệu ví sử dụng dữ liệu doanh thu/đơn hàng hiện có từ DashboardService, không truy cập trực tiếp vào ví của khách hàng nhằm tránh lộ thông tin nhạy cảm.
        </div>
    </div>
</div>
