@page
@model EVStationRental.Presentation.Pages.Staff.VehicleModels.IndexModel
@{
    ViewData["Title"] = "Quản lý mẫu xe";
    Layout = "~/Pages/Staff/Shared/_StaffLayout.cshtml";
}

@if (TempData["Ok"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill"></i> @TempData["Ok"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["Err"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill"></i> @TempData["Err"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="card border-0 shadow-sm">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-bold">
            <i class="bi bi-car-front-fill"></i> Danh sách mẫu xe
        </h5>
        <div class="d-flex gap-2">
            <form method="get" class="d-flex gap-2">
                <input type="text" name="SearchTerm" value="@Model.SearchTerm" class="form-control"
                    placeholder="Tìm kiếm mẫu xe..." style="min-width: 250px;">
                <button type="submit" class="btn btn-outline-primary">
                    <i class="bi bi-search"></i>
                </button>
            </form>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createModal">
                <i class="bi bi-plus-lg"></i> Thêm mẫu xe
            </button>
        </div>
    </div>
    <div class="card-body">
        @if (Model.VehicleModels.Any())
        {
            <div class="row g-4">
                @foreach (var vehicleModel in Model.VehicleModels)
                {
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100 border shadow-sm">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <h5 class="card-title fw-bold text-primary mb-0">@vehicleModel.Name</h5>
                                    @if (vehicleModel.Isactive)
                                    {
                                        <span class="badge bg-success">Hoạt động</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">Ngưng</span>
                                    }
                                </div>
                                <p class="text-muted mb-2">
                                    <i class="bi bi-building"></i> <strong>Hãng:</strong> @vehicleModel.Manufacturer
                                </p>
                                <p class="text-success fw-bold mb-2" style="font-size: 1.1rem;">
                                    <i class="bi bi-cash"></i> @vehicleModel.PricePerHour.ToString("N0") VNĐ/giờ
                                </p>
                                @if (!string.IsNullOrWhiteSpace(vehicleModel.Specs))
                                {
                                    <p class="text-muted small mb-2">
                                        <i class="bi bi-info-circle"></i> @vehicleModel.Specs
                                    </p>
                                }
                                <p class="text-muted small mb-3">
                                    <i class="bi bi-calendar-check"></i> Tạo: @vehicleModel.CreatedAt.ToString("dd/MM/yyyy")
                                </p>
                                <div class="d-flex gap-2 justify-content-end">
                                    <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                                        data-bs-target="#editModal"
                                        onclick="loadEditData('@vehicleModel.VehicleModelId', '@vehicleModel.TypeId', '@vehicleModel.Name', '@vehicleModel.Manufacturer', '@vehicleModel.PricePerHour', '@vehicleModel.Specs')">
                                        <i class="bi bi-pencil"></i> Sửa
                                    </button>
                                    <form method="post" asp-page-handler="Delete" asp-route-id="@vehicleModel.VehicleModelId"
                                        class="d-inline" onsubmit="return confirm('Xác nhận xóa mẫu xe @vehicleModel.Name?')">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">
                                            <i class="bi bi-trash"></i> Xóa
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="text-center text-muted py-5">
                <i class="bi bi-inbox" style="font-size: 3rem;"></i>
                <p class="mt-3">
                    @if (!string.IsNullOrWhiteSpace(Model.SearchTerm))
                    {
                        <span>Không tìm thấy mẫu xe phù hợp</span>
                    }
                    else
                    {
                        <span>Chưa có mẫu xe nào</span>
                    }
                </p>
            </div>
        }
    </div>
</div>

<!-- Create Modal -->
<div class="modal fade" id="createModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="Create">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="bi bi-plus-circle"></i> Thêm mẫu xe mới</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <label asp-for="CreateVehicleModelDto.TypeId" class="form-label">
                                Loại xe <span class="text-danger">*</span>
                            </label>
                            <select asp-for="CreateVehicleModelDto.TypeId" asp-items="Model.VehicleTypes"
                                class="form-select" required>
                                <option value="">-- Chọn loại xe --</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label asp-for="CreateVehicleModelDto.Name" class="form-label">
                                Tên mẫu xe <span class="text-danger">*</span>
                            </label>
                            <input asp-for="CreateVehicleModelDto.Name" class="form-control" required />
                        </div>
                        <div class="col-12">
                            <label asp-for="CreateVehicleModelDto.Manufacturer" class="form-label">
                                Hãng sản xuất <span class="text-danger">*</span>
                            </label>
                            <input asp-for="CreateVehicleModelDto.Manufacturer" class="form-control" required />
                        </div>
                        <div class="col-12">
                            <label asp-for="CreateVehicleModelDto.PricePerHour" class="form-label">
                                Giá thuê/giờ (VNĐ) <span class="text-danger">*</span>
                            </label>
                            <input asp-for="CreateVehicleModelDto.PricePerHour" type="number" step="0.01" min="0"
                                class="form-control" required />
                        </div>
                        <div class="col-12">
                            <label asp-for="CreateVehicleModelDto.Specs" class="form-label">
                                Thông số kỹ thuật
                            </label>
                            <textarea asp-for="CreateVehicleModelDto.Specs" class="form-control" rows="3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-save"></i> Lưu
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="Update">
                <input type="hidden" asp-for="VehicleModelIdToUpdate" id="editVehicleModelId" />
                <div class="modal-header bg-warning">
                    <h5 class="modal-title"><i class="bi bi-pencil-square"></i> Cập nhật mẫu xe</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <label asp-for="UpdateVehicleModelDto.TypeId" class="form-label">
                                Loại xe <span class="text-danger">*</span>
                            </label>
                            <select asp-for="UpdateVehicleModelDto.TypeId" asp-items="Model.VehicleTypes"
                                class="form-select" id="editTypeId" required>
                                <option value="">-- Chọn loại xe --</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label asp-for="UpdateVehicleModelDto.Name" class="form-label">
                                Tên mẫu xe <span class="text-danger">*</span>
                            </label>
                            <input asp-for="UpdateVehicleModelDto.Name" class="form-control" id="editName" required />
                        </div>
                        <div class="col-12">
                            <label asp-for="UpdateVehicleModelDto.Manufacturer" class="form-label">
                                Hãng sản xuất <span class="text-danger">*</span>
                            </label>
                            <input asp-for="UpdateVehicleModelDto.Manufacturer" class="form-control"
                                id="editManufacturer" required />
                        </div>
                        <div class="col-12">
                            <label asp-for="UpdateVehicleModelDto.PricePerHour" class="form-label">
                                Giá thuê/giờ (VNĐ) <span class="text-danger">*</span>
                            </label>
                            <input asp-for="UpdateVehicleModelDto.PricePerHour" type="number" step="0.01" min="0"
                                class="form-control" id="editPricePerHour" required />
                        </div>
                        <div class="col-12">
                            <label asp-for="UpdateVehicleModelDto.Specs" class="form-label">
                                Thông số kỹ thuật
                            </label>
                            <textarea asp-for="UpdateVehicleModelDto.Specs" class="form-control" rows="3"
                                id="editSpecs"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-warning">
                        <i class="bi bi-save"></i> Cập nhật
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function loadEditData(vehicleModelId, typeId, name, manufacturer, pricePerHour, specs) {
            document.getElementById('editVehicleModelId').value = vehicleModelId;
            document.getElementById('editTypeId').value = typeId;
            document.getElementById('editName').value = name;
            document.getElementById('editManufacturer').value = manufacturer;
            document.getElementById('editPricePerHour').value = pricePerHour;
            document.getElementById('editSpecs').value = specs || '';
        }

        setTimeout(function () {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function (alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 3000);
    </script>
}